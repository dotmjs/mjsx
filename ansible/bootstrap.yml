---
- name: Prep bootstrap system
  hosts: bootstrap
  remote_user: root
  roles:
    - role: mjsxio.libvirt_host

  tasks:
  - name: Ensure supporting packages are installed, and at latest version
    ansible.builtin.dnf:
      name:
        - git
        - ansible-core
        - ansible-freeipa
        - cockpit
        - cockpit-machines
      state: latest

  - name: Enable cockpit service
    service:
      name: cockpit
      enabled: true
      state: started

- name: Create bootstrap IPA
  hosts: ipa-0
  remote_user: root
  roles:
    - role: mjsxio.libvirt_guest
  gather_facts: no
  