---
- name: Prep bootstrap system
  hosts: bootstrap
  remote_user: root
  roles:
    - role: mjsxio.libvirt_host

  tasks:
  - name: Ensure supporting packages are installed, and at latest version
    ansible.builtin.dnf:
      name:
        - libvirt-daemon-kvm
        - git
        - ansible-core
        - ansible-freeipa
        - cockpit
        - cockpit-machines
      state: latest

  - name: Enable cockpit service
    service:
      name: cockpit
      enabled: true
      state: started

- name: Create bootstrap IPA
  hosts: bootstrap
  remote_user: root
  
  tasks:
  - name: Create IPA VM
    community.libvirt.virt:
      command: define
      xml: "{{ lookup('template', 'vm_template.xml.j2') }}"
      autostart: true